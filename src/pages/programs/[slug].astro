---
import BaseLayout from "../../layouts/BaseLayout.astro";
import ImageComp from "../../components/ImageComp.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const items = await getCollection("programs");
  return items.map((p) => ({
    params: { slug: p.slug },
    props: { program: p },
  }));
}

const { program } = Astro.props;
const data = program.data;
const { Content } = await program.render();

const siteTitle = `${data.title} | NV Flight`;
const siteDescription = data.description;

const courseLD = {
  "@context": "https://schema.org",
  "@type": "Course",
  name: data.title,
  description: data.description,
  provider: { "@type": "Organization", name: "NV Flight" },
};
---

<BaseLayout siteTitle={siteTitle} siteDescription={siteDescription}>
  <script type="application/ld+json">{JSON.stringify(courseLD)}</script>

  <header class="relative isolate overflow-hidden mt-32">
    <div class="mx-auto max-w-7xl px-6 py-12 sm:py-16 lg:px-8">
      <div class="grid grid-cols-1 gap-8 lg:grid-cols-2 lg:items-center">
        <div>
          <p class="text-xs uppercase tracking-[0.2em] text-accent-700">{data.part} {data.part && data.syllabus ? "â€¢" : ""} {data.syllabus}</p>
          <h1 class="mt-2 text-4xl font-bold tracking-tight text-slate-900 sm:text-5xl">{data.title}</h1>
          <p class="mt-6 text-lg leading-8 text-slate-700">{data.description}</p>
          <div class="mt-8 flex gap-3">
            <a href="/contact" class="inline-flex items-center rounded-lg bg-primary-600 px-5 py-2.5 text-sm font-medium text-white hover:bg-accent-700">Get Started</a>
            <a href="/contact" class="inline-flex items-center rounded-lg border border-accent-200 px-5 py-2.5 text-sm font-medium text-accent-700 hover:bg-accent-50">Contact Us</a>
          </div>
        </div>
        <div class="overflow-hidden rounded-2xl border border-slate-200 shadow-sm">
          <ImageComp imagePath={data.imagePath} imageAlt={data.imageAlt} styles="h-full w-full object-cover" quality={90} loading="eager" />
        </div>
      </div>
    </div>
  </header>

  <main>
    <section class="mx-auto max-w-7xl px-6 py-12 lg:px-8">
      <div class="grid grid-cols-1 gap-10 lg:grid-cols-3">
        <article class="lg:col-span-2">
          {data.highlights?.length > 0 && <>
            <h2 class="text-2xl font-semibold text-slate-900">What you'll learn</h2>
            <ul class="mt-4 grid list-disc gap-2 pl-6 text-slate-700">
              {data.highlights.map((h) => <li>{h}</li>)}
            </ul>
          </>}

          <h2 class="mt-10 text-2xl font-semibold text-slate-900">Training structure</h2>
          <p class="mt-2 text-slate-700">
            Training combines ground lessons, flight sessions, and stage checks aligned to the ACS. Individual and accelerated pacing are available depending on instructor and aircraft availability.
          </p>

          {data.outcomes?.length > 0 && <>
            <h2 class="mt-10 text-2xl font-semibold text-slate-900">Outcomes</h2>
            <ul class="mt-4 list-disc pl-6 text-slate-700">
              {data.outcomes.map((o) => <li>{o}</li>)}
            </ul>
          </>}

          {data.prerequisites?.length > 0 && <>
            <h2 class="mt-10 text-2xl font-semibold text-slate-900">Prerequisites</h2>
            <ul class="mt-4 list-disc pl-6 text-slate-700">
              {data.prerequisites.map((p) => <li>{p}</li>)}
            </ul>
          </>}

          <!-- Optional rich body below (MD/MDX contents) -->
          <div class="prose prose-slate mt-10">
            <Content />
          </div>
        </article>

        <aside class="lg:col-span-1">
          <div class="sticky top-6 space-y-6">
            {data.idealFor?.length > 0 && (
              <div class="rounded-2xl border border-slate-200 bg-slate-50 p-6">
                <h3 class="text-lg font-semibold text-slate-900">Is this program right for you?</h3>
                <ul class="mt-3 list-disc pl-6 text-slate-700">
                  {data.idealFor.map((i) => <li>{i}</li>)}
                </ul>
                <a href="/contact" class="mt-5 inline-flex w-full items-center justify-center rounded-lg bg-accent-600 px-4 py-2 text-sm font-medium text-white hover:bg-accent-700">Talk to an instructor</a>
              </div>
            )}
          </div>
        </aside>
      </div>
    </section>
  </main>
</BaseLayout>
